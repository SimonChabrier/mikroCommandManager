{% extends 'base.html.twig' %}

{% block title %}Mikro Command Manager{% endblock %}

{% block body %}
    <main class="flex-1 container mx-auto px-4 py-6">
        {# Header #}
        <div class="flex items-center gap-3 mb-6">
            {% if is_granted('ROLE_ADMIN') %}
                <a
                    href="{{ path('app_logout') }}"
                    class="w-8 h-8 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg flex items-center justify-center text-gray-400 hover:text-white transition-all duration-300"
                    aria-label="Me déconnecter"
                    title="Me déconnecter"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </a>
            {% else %}
                {# bouton de login avec icône utilisateur #}
                <a
                    href="{{ path('app_login') }}"
                    class="group relative bg-gray-800/50 text-gray-400 hover:text-white py-2 px-2.5 rounded-lg transition-all duration-300 hover:bg-gray-700/50 flex items-center justify-center"
                    aria-label="Connectez vous pour ajouter une commande"
                    title="Connectez vous pour ajouter une commande"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16" aria-hidden="true">
                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                    </svg>
                </a>
            {% endif %}
            <h1 class="text-xl font-semibold text-white">Mikro Command Manager</h1>
        </div>

        {# Barre d'outils compacte #}
        <div class="bg-gray-900/50 backdrop-blur border border-gray-800 rounded-xl p-3 mb-5">
            <div class="flex flex-col sm:flex-row gap-3">
                {# Recherche #}
                <div class="flex-1 relative min-h-[40px]">
                    <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" width="16" height="16">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    <label for="search" class="sr-only">Rechercher</label>
                    <input
                        id="search"
                        type="text"
                        class="w-full bg-gray-800/50 rounded-lg pl-10 pr-4 py-2 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500 glow-input transition-all h-[40px]"
                        data-commands-ui-target="search"
                        data-action="input->commands-ui#search"
                        placeholder="Rechercher (min. 3 car.)"
                    >
                </div>

                {# Toggle ajout #}
                {% if is_granted('ROLE_ADMIN') %}
                    <button
                        class="group relative bg-gray-800/50 hover:bg-gray-700/50 text-gray-400 hover:text-white py-2 px-2.5 rounded-lg transition-all duration-300 flex items-center justify-center"
                        aria-label="Ajouter une commande"
                        title="Ajouter une commande"
                        data-action="click->commands-ui#toggleAddForm"
                    >
                        <svg
                            data-commands-ui-target="plusIcon"
                            class="w-5 h-5 transition-transform duration-300"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            aria-hidden="true"
                        >
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                        </svg>
                    </button>
                {% endif %}
            </div>

            {# Formulaire d'ajout (collapsible) #}
            <div data-commands-ui-target="addFormContainer" class="grid transition-[grid-template-rows] duration-300 ease-out grid-rows-[0fr]">
                <div class="overflow-hidden">
                    <form data-commands-ui-target="addForm" data-action="submit->commands-ui#submitAddForm" class="pt-3 mt-3 border-t border-gray-800">
                        <input
                            type="hidden"
                            data-commands-api-target="csrfToken"
                            value="{{ csrf_token('command_form') }}"
                        >
                        <div class="flex flex-col gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-400 mb-1" for="description">Description</label>
                                <textarea
                                    class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500 glow-input transition-all"
                                    data-commands-ui-target="descriptionInput"
                                    rows="4"
                                    placeholder="Ex: Lister les fichiers"
                                    required
                                    id="description"
                                ></textarea>
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-400 mb-1" for="command">Commande</label>
                                <textarea
                                    class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500 glow-input transition-all font-mono"
                                    data-commands-ui-target="commandInput"
                                    rows="4"
                                    placeholder="Ex: ls -la"
                                    required
                                    id="command"
                                ></textarea>
                            </div>
                        </div>
                        <button
                            type="submit"
                            class="w-full mt-3 flex items-center justify-center gap-2 bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400 text-white py-2.5 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-green-500/30 hover:scale-[1.02]"
                            aria-label="Enregistrer"
                            title="Enregistrer"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        {# Informations sur les resultats #}
        <p data-commands-ui-target="resultsInfo" class="text-gray-500 text-xs mb-3"></p>

        {# Liste des commandes #}
        <div data-commands-ui-target="list" class="space-y-2 mb-6"></div>

        {# Pagination #}
        <div data-commands-ui-target="pagination" class="flex justify-center"></div>

        {# Template pour un élément de commande #}
        <template data-commands-ui-target="commandTemplate">
            <div class="group bg-gray-900/50 border border-gray-800 hover:border-gray-700 rounded-lg p-3 command-item transition-all">
                <div class="flex flex-col gap-2">
                    <div class="flex-1 min-w-0">
                        <p class="text-gray-400 text-xs mb-1 whitespace-pre-wrap break-words" data-role="description"></p>
                        <code class="text-green-400 text-sm font-mono whitespace-pre-wrap break-words block" data-role="command"></code>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button
                            class="copy-btn opacity-20 group-hover:opacity-100 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-blue-600 hover:to-blue-500 text-gray-300 hover:text-white p-2 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/20 hover:scale-110"
                            data-action="click->commands-ui#copy"
                            aria-label="Copier"
                            title="Copier"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                        </button>
                        <button
                            class="edit-btn opacity-20 group-hover:opacity-100 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-amber-600 hover:to-amber-500 text-gray-300 hover:text-white p-2 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-amber-500/20 hover:scale-110"
                            data-action="click->commands-ui#openEditDialog"
                            aria-label="Modifier"
                            title="Modifier"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                        </button>
                        <button
                            class="delete-btn opacity-20 group-hover:opacity-100 bg-gradient-to-r from-gray-700 to-gray-600 hover:from-red-600 hover:to-red-500 text-gray-300 hover:text-white p-2 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-red-500/20 hover:scale-110"
                            data-action="click->commands-ui#confirmDelete"
                            aria-label="Supprimer"
                            title="Supprimer"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </template>

        {# Dialog d'edition #}
        <dialog
            data-commands-ui-target="editDialog"
            class="bg-gray-900 border border-gray-700 rounded-xl p-0"
        >
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-white">Modifier la commande</h2>
                    <button
                        type="button"
                        data-action="click->commands-ui#closeEditDialog"
                        class="text-gray-400 hover:text-white transition-colors"
                        aria-label="Fermer"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <form data-commands-ui-target="editForm" data-action="submit->commands-ui#submitEditForm">
                    <input type="hidden" data-commands-ui-target="editId">
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1">Description</label>
                            <textarea
                                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500 glow-input transition-all"
                                data-commands-ui-target="editDescription"
                                rows="4"
                                required
                            ></textarea>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-400 mb-1">Commande</label>
                            <textarea
                                class="w-full bg-gray-800/50 border border-gray-700 rounded-lg px-3 py-2 text-sm text-gray-100 placeholder-gray-500 focus:outline-none focus:border-blue-500 glow-input transition-all font-mono"
                                data-commands-ui-target="editCommand"
                                rows="4"
                                required
                            ></textarea>
                        </div>
                    </div>
                    <div class="flex gap-2 mt-4">
                        <button
                            type="button"
                            data-action="click->commands-ui#closeEditDialog"
                            class="flex-1 bg-gray-700 hover:bg-gray-600 text-white py-2.5 rounded-lg transition-all"
                        >
                            Annuler
                        </button>
                        <button
                            type="submit"
                            class="flex-1 bg-gradient-to-r from-amber-600 to-amber-500 hover:from-amber-500 hover:to-amber-400 text-white py-2.5 rounded-lg transition-all duration-300 hover:shadow-lg hover:shadow-amber-500/30"
                        >
                            Enregistrer
                        </button>
                    </div>
                </form>
            </div>
        </dialog>

        {# Toast container #}
        <div data-commands-ui-target="toastContainer" class="fixed bottom-16 right-4 space-y-2 z-50"></div>
    </main>

    {# Footer #}
    <footer class="border-t border-gray-800 bg-gray-900 h-[52px]">
        <div class="container mx-auto px-4 py-3 max-w-3xl h-full">
            <div class="flex items-center justify-between text-xs text-gray-500 h-full">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse flex-shrink-0"></span>
                    <span data-commands-ui-target="totalCommands" class="min-w-[90px]">0 commandes</span>
                </div>
                <span class="font-mono">v1.0</span>
            </div>
        </div>
    </footer>
{% endblock %}
